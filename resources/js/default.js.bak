$(document).ready(function(){
	pageMain.init();

	/*gnb*/
	$SubMenu = $('div.Gnb .gnbMenu ul.gnb-menu li.active ul.SubMenu');
	$SubImg = $('.gnb-imgBox');
/*	$BgNavy1 = 'rgba(44, 89, 129, 0.7)';
	$BgNavy2 = 'rgba(44, 89, 129, 0.79)';
	  */

	$('.gnb').css('height','auto')
	var time=200;
	$SubMenu.stop().fadeOut(time);
    $SubImg.stop().fadeOut(time);
    $('.gnbMenu > .gnb-menu > li').on('focusin mouseenter', function(e){
    	e.preventDefault();
    	$('.gnbMenu').removeClass('active');
    	$('.gnb-menu > li').removeClass('active');
        $('.SubMenu ').removeClass('active');
        $('.SubMenu  > li > ul').removeClass('active');
        $('.SubMenu  > li > ul > li').removeClass('active');

        $('.gnbMenu').addClass('active');
        $(this).addClass('active');
        $(this).find('.subMenu').addClass('active');
        $(this).find('.SubMenu  > li > ul').addClass('active');
        $(this).find('.SubMenu  > li > ul > li').addClass('active');

        $SubMenu.css('background','#fff')
//        $('#gnbWrap').css('border-bottom','1px solid black')

        $SubMenu.stop().fadeIn(time, function(){
        	$SubMenu.css('display','inline');
        });
        $SubImg.stop().fadeIn(time, function(){
        	$SubImg.css('display','inline');
        });


    });

    $('.gnb').on('blur mouseleave', function(e){
    	e.preventDefault();
    	$('.gnbMenu').removeClass('active');
    	$('.gnb-menu  > li').removeClass('active');
        $('.SubMenu ').removeClass('active');
        $('.SubMenu  > li > ul').removeClass('active');
        $('.SubMenu  > li > ul > li').removeClass('active');
        $('#gnbWrap').css('border-bottom','#e2e2e2')
        $SubImg.stop().fadeOut(time);
        $SubMenu.stop().fadeOut(time);
    })

    $('.Gnb .util').on('focusin mouseenter' , function(e){
    	e.preventDefault();
      	$('.gnbMenu').removeClass('active');
      	$('.gnb-menu  > li').removeClass('active');
	    $('.SubMenu ').removeClass('active');
	    $('.SubMenu  > li > ul').removeClass('active');
	    $('.SubMenu  > li > ul > li').removeClass('active');
	    $('#gnbWrap').css('border-bottom','#e2e2e2')
	    $SubImg.stop().fadeOut(time);
	    $SubMenu.stop().fadeOut(time);
      });

      $('#header #gnbWrap .logo').on('focusin mouseenter' , function(e){
    	e.preventDefault();
      	$('.gnbMenu').removeClass('active');
      	$('.gnb-menu  > li').removeClass('active');
	    $('.SubMenu ').removeClass('active');
	    $('.SubMenu  > li > ul').removeClass('active');
	    $('.SubMenu  > li > ul > li').removeClass('active');
	    $('.gnb').css('height','auto')
	    $('#gnbWrap').css('border-bottom','#e2e2e2')
	    $SubMenu.stop().fadeOut(time);
        $SubImg.stop().fadeOut(time);
      });

      var time=0.8;
/*      $('.SubMenu  > li ').on('focusin mouseenter' , function(e){
    		$(this).find('a:first').css('background',$BgNavy1);
      });

      $('.SubMenu  > li ').on('blur mouseleave' , function(e){
    	  $(this).find('a:first').css('background','none');
       });
      */

      /*gnb 검색버튼*/

      $('#header #gnbWrap .util .searchBtn').on('click' , function(e){
    	  var $search = $('#header #gnbWrap .util input');
      	e.preventDefault();
      	$search.animate({
      	    opacity: 0.25,
      	    right: 50,
      	    display: 'inline-block'
//      	    left: "+=50",
      	   /* height: "toggle",*/
      	  }, 1500, function() {
      	    // Animation complete.
      	  });
//      	$search.hide("slide", { direction: "left" }, 5000);
//      	$search.show("slide", { direction: "right" }, 5000);

      });

      var bx1 = $('.main5 ul.main5-banner').bxSlider({
 		 mode: 'horizontal',
 		 speed: 600,
 		 auto: true,
 		stopAutoOnClick: true,
        autoHover: true,
        autoControls: false,
        controls: true,
        pager: false,
        moveSlides: 1,
        slideMargin: 0,
        autoReload: true,
       });
      
		$('.main5 ul.main5-banner').on('focusin', function(){
			bx1.stopAuto();
//			bx1.css('transform', 'translate3d(0, 0px, 0px)');
		});


 	var bx2 = $('.main5 ul.main5-popupZone').bxSlider({
 		 mode: 'horizontal',
 		 speed: 600,
 		 auto: true,
 		stopAutoOnClick: true,
        autoHover: true,
        autoControls: false,
        controls: true,
        pager: false,
        moveSlides: 1,
        slideMargin: 0,
        autoReload: true,
       });
 	
	$('.main5 ul.main5-popupZone').on('focusin', function(){
		bx2.stopAuto();
//		bx2.css('transform', 'translate3d(0, 0px, 0px)');
	});

      var mmenuFlag = true;
  	$('div.mmode > a, div.mmode > a#mmode').on('click', function() {
  		if ( mmenuFlag ) {
  			try {
  				$('nav#menu').html(navi);
  				$('nav#menu').mmenu({
  					"offCanvas": {
  						"position": "front"
  					},
  					"slidingSubmenus": false,
  					"navbars": true,
  					"extensions": [
  					               "shadow-page",
  					               "pagedim-black",
  					               "border-full"
  					               ]
  				});
  				$('ul.mm-listview a.mm-next').addClass('mm-fullsubopen');
  				$('a.mm-title').html('<div class="mmode-title-top"><span>Happy Tomorrow, Beyond Safety</span><a href="/korad/homepageSearch/index.do?menu_idx=142"><img src="/resources/homepage/korad/img/btn_srch_w.png" alt="검색"></a><a href="/korad-eng/index.do" title="코라드 영문페이지로 이동">ENG</a></div>');
  				/* 닫기버튼
  				.after('<div class="mmenu_close"><span class="blind">닫기</span><i class="fa fa-close"></i></div>');
  				var API = $("nav#menu").data("mmenu");
  				$(".mmenu_close").click(function(){
  			       API.close();
  			    });
  			    */
  			} catch (e) {
  				// TODO: handle exception
  			}
  			mmenuFlag = false;
  			 var speed = 250;
  		     var easing = 'linear';
  			$('div.mm-vertical ul.gnb-menu > li').find('ul.SubMenu').animate({opacity:'0.15',top:'20px'}, {duration:speed, easing:easing, queue:false});
  			$('div.mm-vertical ul.gnb-menu > li > a.mm-next').on('click', function() {
  				$('div.mm-vertical ul.gnb-menu > li').find('ul.SubMenu').animate({opacity:'0.15',top:'20px'}, {duration:speed, easing:easing, queue:false});
  				if (!$(this).parent('li').hasClass('mm-opened')) {
  					var index = $('div.mm-vertical ul.gnb-menu > li > a.mm-next').index($(this));
  					$('div.mm-vertical ul.gnb-menu > li').not(index).removeClass('mm-opened');
  				}

  				if (!$('div.mm-vertical ul.gnb-menu > li').hasClass('mm-opened')) {
  					$(this).parent('li').find('ul.SubMenu').animate({opacity:'1',top:'2px'}, {duration:speed, easing:easing, queue:false});

  				}else{
  					$('div.mm-vertical ul.gnb-menu > li').find('ul.SubMenu').animate({opacity:'0.15',top:'20px'}, {duration:speed, easing:easing, queue:false});
  				}


  			});
  			

  			$('ul.gnb-menu.mm-listview a:not(.mm-next)').on('click', function(e) {
  				e.preventDefault();
  				var hasNext = $(this).next().length;
  				var url = $(this).attr('href');
  				if (hasNext == 0) {
  					if ($(this).attr('target') == '_blank') {
						window.open(url);
					} else {
						location.href = url;
					}
  				} else {
  					var nextA = $(this).next().find('ul:eq(0)').find('li:eq(0)').find('a:not(.mm-next):eq(0)');
  					url = $(nextA).attr('href');

  					if (url != '') {

  						if ($(nextA).attr('target') == '_blank') {
  							window.open(url);
  						} else {
  							location.href = url;
  						}
  					} else {

  						var nextB = $(nextA).next().find('ul:eq(0)').find('li:eq(0)').find('a:not(.mm-next):eq(0)');
  						url = $(nextB).attr('href');

  						if (url != '') {
  							if ($(nextB).attr('target') == '_blank') {
  	  							window.open(url);
  	  						} else {
  	  							location.href = url;
  	  						}
  	  					} else {

	  	  					var nextC = $(nextB).next().find('ul:eq(0)').find('li:eq(0)').find('a:not(.mm-next):eq(0)');
	  						url = $(nextC).attr('href');

	  						if ($(nextC).attr('target') == '_blank') {
	  							window.open(url);
	  						} else {
	  							location.href = url;
	  						}
  	  					}
  					}
  				}
  			});

  		}
  		if (window.location.href.indexOf('lib.sen.go.kr/lib') < 0) {
  			$('nav#menu div.mm-vertical ul.gnbMenu > li.1Depth:contains("마이라이브러리")').remove();
  		}
//  		$('.gnb-menu.mm-listview.mm-vertical').append('<li class="List mm-vertical"><a href="/dme/eng.jsp" target="_blank"><span>ENGLISH</span></a>');
  		$('nav#menu li').show();
  	} );



  	var navi = $('div.Gnb div.gnbMenu').html();

  	/*새창열기*/
  	$('.gnbMenu .gnb-menu a[target$="blank"]').each(function(){
		$(this).addClass('newWin');
		if($(this).children('i').length < 1){
			$(this).append('<img src="/resources/homepage/korad/img/btn_blank2.gif" alt="새창열림"></i>');
		}
	});

      /*이미지 확대*/
  		$(".scale").hover(function () {
  			if ($(this).css('opacity') == 1) {
  		      	$(this).stop().animate({transform: 'scale(1.5)'},200);
  			}
  		  },
  		  function () {
  			if ($(this).css('opacity') == 1) {
  				$(this).stop().animate({transform: 'scale(1)'},200);
  			}
  		  });

  		$(".scale2").hover(function () {
  			if ($(this).css('opacity') == 1) {
  		      $(this).stop().animate({ transform: 'scale(1.5)'},200);
  			}
  		  },
  		  function () {
  			if ($(this).css('opacity') == 1) {
  			 $(this).stop().animate({transform: 'scale(1)'},200);
  			}
  		  });

  		var zoomLevel = 100;
  		var updateZoom = function(zoom) {
  			zoomLevel += zoom;
  			$('body').css("zoom", zoomLevel+"%");
  		}


  		$('li.zoom-plus a').on('click', function(e) {
  			e.preventDefault();
  			updateZoom(5);
  		});

  		$('li.zoom-minus a').on('click', function(e) {
  			e.preventDefault();
  			updateZoom(-5);
  		});

	var popupZoneLength = $('div.popupZone ul').length;
	var popupZone;
	if (popupZoneLength > 0) {
		popupZone = $('div.popupZone ul').bxSlider({
			mode:'fade',
			auto:true,
			stopAutoOnClick: true,
			controls:true,
			autoHover:true,
			pagerType:'short',
			onSliderLoad:function(currentIndex) {
				var pager = $('div.popupZone div.bx-pager').text().split(' ');
				var pagerHtml = '<span class="blue">'+pager[0]+'</span>'+pager[1]+pager[2];
				$('div.popupZone span#pager').html(pager);
			},
			onSliderResize:function() {
				var pager = $('div.popupZone div.bx-pager').text().split(' ');
				var pagerHtml = '<span class="blue">'+pager[0]+'</span>'+pager[1]+pager[2];
				$('div.popupZone span#pager').html(pager);
			},
			onSlideBefore:function() {
				var pager = $('div.popupZone div.bx-pager').text().split(' ');
				var pagerHtml = '<span class="blue">'+pager[0]+'</span>'+pager[1]+pager[2];
				$('div.popupZone span#pager').html(pager);
			},
			onSlideAfter:function() {
				var pager = $('div.popupZone div.bx-pager').text().split(' ');
				var pagerHtml = '<span class="blue">'+pager[0]+'</span>'+pager[1]+pager[2];
				$('div.popupZone span#pager').html(pager);
			},
			onSlideNext:function() {
				var pager = $('div.popupZone div.bx-pager').text().split(' ');
				var pagerHtml = '<span class="blue">'+pager[0]+'</span>'+pager[1]+pager[2];
				$('div.popupZone span#pager').html(pager);
			},
			onSlidePrev:function() {
				var pager = $('div.popupZone div.bx-pager').text().split(' ');
				var pagerHtml = '<span class="blue">'+pager[0]+'</span>'+pager[1]+pager[2];
				$('div.popupZone span#pager').html(pager);
			},
		});
		$('div.popupZone ul').on('focusin', function(){
			popupZone.stopAuto();
//			popupZone.css('transform', 'translate3d(0, 0px, 0px)');
		});
	}
	$('div.popupZone a.prev').on('click',function(){
	    if(popupZone != null ){
	    	popupZone.goToPrevSlide();
	    }
	    return false;
	});
	$('div.popupZone a.next').on('click',function(){
	    if(popupZone != null){
	    	popupZone.goToNextSlide();
	    }
	    return false;
	});
	$('div.popupZone a.stop').on('click',function(){
		if(popupZone != null){
			popupZone.stopAuto();
		}
		$(this).removeClass('active');
		$('div.popupZone a.play').addClass('active');
		return false;
	});
	$('div.popupZone a.play').on('click',function(){
		if(popupZone != null){
			popupZone.startAuto();
		}
		$(this).removeClass('active');
		$('div.popupZone a.stop').addClass('active');
		return false;
	});

	var bannerLength = $('div.bannerbox ul.bannerImg').length;
	var bannerWrap = $('div.banner');
	if(bannerWrap.hasClass('noAuto')){
		var autoType = false;
	}else{
		var autoType = true;
	}

	var bannerSlider;

	if (bannerLength > 0) {
		bannerSlider = $('div.bannerbox ul.bannerImg').bxSlider({
			slideWidth:167,
			speed:500,
			moveSlides:1,
			maxSlides:3,
			auto:autoType,
			stopAutoOnClick: true,
			autoHover:true,
			pager:false,
			controls:false
		});
		
		$('div.bannerbox ul.bannerImg').on('focusin', function(){
			bannerSlider.stopAuto();
//			bannerSlider.css('transform', 'translate3d(0, 0px, 0px)');
		});
	}

	$('div.bannerBtn a.prev').on('click',function(){
	    if(bannerSlider != null ){
	    	bannerSlider.goToPrevSlide();
	    }
	    return false;
	});
	$('div.bannerBtn a.next').on('click',function(){
	    if(bannerSlider != null){
	    	bannerSlider.goToNextSlide();
	    }
	    return false;
	});
	$('div.bannerBtn a.stop').on('click',function(){
		if(bannerSlider != null){
			bannerSlider.stopAuto();
		}
		$(this).removeClass('active');
		$('div.bannerBtn a.play').addClass('active');
		return false;
	});
	$('div.bannerBtn a.play').on('click',function(){
		if(bannerSlider != null){
			bannerSlider.startAuto();
		}
		$(this).removeClass('active');
		$('div.bannerBtn a.stop').addClass('active');
		return false;
	});


	$('div.notice a.tab').on('click', function(e) {
		e.preventDefault();
		$('div.notice ul.title li').removeClass('on');
		$(this).parent().addClass('on');
		$('div.notice ul.list').removeClass('on');
		$('div.notice ul.list.'+$(this).data('tab')).addClass('on');
		$('li.lastLi a#boardMore').attr('href', $('div.notice ul.list.' + $(this).data('tab')).data('link'));
	});



    $('div.tab-menu > ul > li > a, div.tablink > ul > li > a, div.tabmenu.on > ul > li > a').on('click',function(e){
        e.preventDefault();
        $(this).parents('ul').children().removeClass('active');

        if(!($(this).parent().hasClass('active'))){
            $(this).parents('ul').children().removeClass('active');
            $(this).parent().parent().parent().parent().children('div.tabCon').removeClass('active');
            var activeTab = $(this).attr('href');
            $(this).parent().addClass('active');
            $(activeTab).addClass('active');
        }
    });


    $(document).on('mouseenter', '.gnbMenu > li', function(){
        $('.subMenu').removeClass('active');
        $(this).find('.subMenu').addClass('active');
    });
    $(document).on('mouseleave', '#gnbWrap', function(){
        $('.subMenu').removeClass('active');
    })

    $('#footer .site1 .movebtn').click(function(e){
		var url=$('.site1 select option:selected').val();
		if (url == '') {
			alert('이동할 사이트를 선택해주세요');
			return false;
		}
		var openNewWindow = window.open("about:blank");
		openNewWindow.location.href=url;

		e.preventDefault();
	});$('#footer .site2 .movebtn').click(function(e){
		var url=$('.site2 select option:selected').val();
		if (url == '') {
			alert('이동할 사이트를 선택해주세요');
			return false;
		}
		var openNewWindow = window.open("about:blank");
		openNewWindow.location.href=url;

		e.preventDefault();
	});


    $('div.tab2').hide();
    $('div.tab3').hide();
    $('div.tab4').hide();
    $('div.tab5').hide();

    $('div.tabmenu>ul>li>a').on('click', function(e) {
    $(this).parent().removeClass('active');
    $('div.tabmenu>ul>li').removeClass('active');

	  var target = this.getAttribute('href').replace('#','');
      var $box = $(this).closest('.containMenu');

        $box.find('.active').removeClass('active');
        $(this).parent().addClass('active');

        $box.find('.hideDiv').hide();
        $box.find('[data-tab="'+target+'"]').show();
    });

	$('div.tab3_2').hide();

	$('ul.conTab>li>a.tab_3_1').on('click', function(e) {
		$('div.tab3_2').hide();
		$('div.tab3_1').show();
	});
	$('ul.conTab>li>a.tab_3_2').on('click', function(e) {
		$('div.tab3_1').hide();
		$('div.tab3_2').show();
	});

    $('div.hideHistory').hide();
    $('div.firstShow').show();
	$('ul.history_tab>li>a').on('click', function(e) {
        var target = this.getAttribute('href').replace('#','');
        var $box = $(this).closest('div.tabBox');
        $box.find('li.on').removeClass('on');
        $(this).parent().addClass('on');

        $box.find('.hideHistory').hide();
        $box.find('div.'+target).show();
    });


	var link_new_win = '새창으로 열립니다.';
	$('a').each(function(){
		if($(this).attr('target') == '_blank' && $(this).attr('title') == null ){
			$(this).attr('title', link_new_win);
		}
	});

	$('body div#header li.1Depth > a').on('click', function(e) {
		var listDepth2 = $(this).parent().find('li.2Depth');
		var listDepth3 = listDepth2.eq(0).find('li.3Depth');
		var listDepth4 = listDepth3.eq(0).find('li.4Depth');

		if(listDepth4.length > 0) {
			e.stopPropagation();
			e.preventDefault();
			var aTag = listDepth4.eq(0).find('a');
			if($(aTag).attr('target') == '_black') {
				window.open(listDepth4.eq(0).find('a').attr('href'));
			} else {
				location.href = listDepth4.eq(0).find('a').attr('href');
			}
		} else if ( listDepth3.length > 0 ) {
			e.stopPropagation();
			e.preventDefault();
			var aTag = listDepth3.eq(0).find('a');
			if ($(aTag).attr('target') == '_blank') {
				window.open(listDepth3.eq(0).find('a').attr('href'));
			} else {
				location.href = listDepth3.eq(0).find('a').attr('href');
			}
		} else {
			if ( listDepth2.length > 0 ) {
				e.stopPropagation();
				e.preventDefault();
				listDepth2.eq(0).find('a').click();
			}
			else {
				return true;
			}
		}
	});

	$('body div#header li.2Depth > a').on('click', function(e) {
		var listDepth3 = $(this).parent().find('li.3Depth');
		var listDepth4 = listDepth3.eq(0).find('li.4Depth');

		if(listDepth4.length > 0) {
			e.stopPropagation();
			e.preventDefault();
			var aTag = listDepth4.eq(0).find('a');
			if($(aTag).attr('target') == '_black') {
				window.open(listDepth4.eq(0).find('a').attr('href'));
			} else {
				location.href = listDepth4.eq(0).find('a').attr('href');
			}
		} else if ( listDepth3.length > 0 ) {
			var aTag = listDepth3.eq(0).find('a');
			e.stopPropagation();
			e.preventDefault();
			if ($(aTag).attr('target') == '_blank') {
				window.open(listDepth3.eq(0).find('a').attr('href'));
			} else {
				location.href = listDepth3.eq(0).find('a').attr('href');
			}
		}
		else {
			e.stopPropagation();
			e.preventDefault();
			var aTag = $(this);
			if ($(aTag).attr('target') == '_blank') {
				window.open($(this).attr('href'));
			} else {
				location.href = $(this).attr('href');
			}
		}
	});

	$('body div#header li.3Depth > a').on('click', function(e) {
		var listDepth4 = $(this).parent().find('li.4Depth');

		if ( listDepth4.length > 0 ) {
			var aTag = listDepth4.eq(0).find('a');
			e.stopPropagation();
			e.preventDefault();
			if ($(aTag).attr('target') == '_blank') {
				window.open(listDepth4.eq(0).find('a').attr('href'));
			} else {
				location.href = listDepth4.eq(0).find('a').attr('href');
			}
		}
		else {
			e.stopPropagation();
			e.preventDefault();
			var aTag = $(this);
			if ($(aTag).attr('target') == '_blank') {
				window.open($(this).attr('href'));
			} else {
				location.href = $(this).attr('href');
			}
		}
	});

	$('body div#header li.4Depth > a').on('click', function(e) {
		var listDepth4 = $(this).parent().find('li.4Depth');

		e.stopPropagation();
		e.preventDefault();
		var aTag = $(this);
		if ($(aTag).attr('target') == '_blank') {
			window.open($(this).attr('href'));
		} else {
			location.href = $(this).attr('href');
		}
	});

	$(window).scroll(function() {
		var position = $(window).scrollTop();

		$('a#goTop').css('display', 'none');
		if(position > 80){
			$('a#goTop').css('display','block').css('z-index','999999');
		} else {
			$('a#goTop').css('display','none');
		}
	});

/*	$(".subQuickMenu").animate( { "top": $(document).scrollTop() +400 +"px" }, 500 );
	$(window).scroll(function(){
		$(".subQuickMenu").stop();
		$(".subQuickMenu").animate( { "top": $(document).scrollTop() +400 + "px" }, 500 );
	});*/
	
	$('select#locationSite').on('change', function(e) {
		e.preventDefault();
		var link = $(this).val();
		
		if(link == '') {
			return false;
		}
		
		window.open(link);
	});

});


var pageMain = (function(){
	var init, slider;

	init = function() {
		slider();
	}

	slider = function(){
		var bx = $('.rightSection .bxslider').bxSlider({
			mode:'fade',
            controls: false,
            touchEnabled: true,
            auto: true,
            stopAutoOnClick: true,
            responsive: true,
            moveSlides: 1,
            slideMargin: 0,
            autoReload: true
		});
		
		$('.rightSection .bxslider').on('focusin', function(){
			bx.stopAuto();
//			bx.css('transform', 'translate3d(0, 0px, 0px)');
		});



	};

	return {
		init: init
	}
})();

$(document).bind("contextmenu", function(e){
	if($(location).attr('host').indexOf('localhost') < 0 ){
		 alert("마우스 우클릭 기능을 이용할 수 없습니다.");
		  return false;
	}
});